<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ARゴミ出しカード</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>body{margin:0;overflow:hidden}</style>
</head>
<body>
  <a-scene embedded vr-mode-ui="enabled:false" renderer="antialias:true; logarithmicDepthBuffer:true" arjs="sourceType:webcam; debugUIEnabled:false">
    <a-assets><canvas id="c" width="1280" height="880"></canvas></a-assets>
    <a-marker preset="hiro">
      <a-plane position="0 0.7 0" rotation="-90 0 0" width="1.9" height="1.25" material="src:#c; side:double"></a-plane>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const SCHEDULE = [
      {name:"可燃ごみ",        days:[1,4]}, // 月・木
      {name:"プラスチックごみ", days:[2]},   // 火
      {name:"ビンカン",        days:[5]},   // 金
      {name:"古紙",            days:[5]}    // 金
    ];

    function nextDateForWeekday(day){
      const now = new Date();
      const d = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const wd = ((d.getDay()+6)%7)+1; // JS(日0)→(月1..日7)
      let diff = (day - wd + 7) % 7;
      if (diff === 0) diff = 7;
      d.setDate(d.getDate() + diff);
      return d;
    }
    function fmt(d){
      return d.toLocaleDateString("ja-JP", {month:"numeric", day:"numeric", weekday:"short"});
    }
    function compute(){
      return SCHEDULE.map(it=>{
        const dates = it.days.map(nextDateForWeekday).sort((a,b)=>a-b);
        return {name:it.name, date:dates[0]};
      }).sort((a,b)=>a.date-b.date);
    }
    function draw(list){
      const ctx = c.getContext('2d');
      ctx.fillStyle="#fff"; ctx.fillRect(0,0,c.width,c.height);
      ctx.strokeStyle="#222"; ctx.lineWidth=8; ctx.strokeRect(20,20,c.width-40,c.height-40);

      ctx.fillStyle="#111"; ctx.textAlign="center"; ctx.textBaseline="top";
      ctx.font='bold 72px system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif';
      ctx.fillText("次のゴミ出し", c.width/2, 40);

      ctx.textAlign="left";
      ctx.font='56px system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif';
      let y=180;
      list.forEach(({name,date})=>{
        ctx.fillStyle="#333";
        ctx.fillText(`${name}：${fmt(date)}`, 100, y);
        y+=90;
      });

      const soon = list[0];
      ctx.fillStyle="#0a7";
      ctx.font='bold 60px system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif';
      ctx.fillText(`最優先 → ${soon.name}：${fmt(soon.date)}`, 100, y+30);

      const plane=document.querySelector('a-plane');
      const m=plane.getObject3D('mesh');
      if(m?.material?.map) m.material.map.needsUpdate=true;
    }

    window.addEventListener('load', ()=>draw(compute()));
  </script>
</body>
</html>
